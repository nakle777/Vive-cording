<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>바이브코딩 동의서 & 참가자 조회</title>
  <style>
    :root{ --bg:#f7f7fb; --card:#ffffff; --ink:#111827; --muted:#6b7280; --line:#e5e7eb; --brand:#111827; --ok:#065f46; --okbg:#ecfdf5; --warn:#7c2d12; --warnbg:#fff7ed; }
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple SD Gothic Neo","Noto Sans KR","Malgun Gothic",sans-serif;margin:0;background:var(--bg);color:var(--ink);line-height:1.55}
    .wrap{max-width:900px;margin:6vh auto;padding:0 16px}
    .card{background:var(--card);border-radius:16px;box-shadow:0 8px 30px rgba(0,0,0,.06);padding:24px}
    h1{font-size:22px;margin:0 0 8px} h2{font-size:18px;margin:24px 0 8px} h3{font-size:15px;margin:18px 0 8px}
    p{margin:8px 0} .grid{display:grid;grid-template-columns:1fr;gap:16px} @media(min-width:900px){ .grid{grid-template-columns:1fr 1fr} }
    .section{border:1px solid var(--line);border-radius:12px;padding:16px}
    .scroll{max-height:240px;overflow:auto;border:1px solid var(--line);border-radius:10px;padding:12px;background:#fafafa}
    label{font-size:14px} input[type="text"]{width:100%;padding:12px 14px;border:1px solid #e2e2ea;border-radius:10px;outline:none}
    input[type="text"]:focus{border-color:#6366f1;box-shadow:0 0 0 3px rgba(99,102,241,.15)} input[type="checkbox"]{transform:scale(1.15);margin-right:8px}
    .row{display:flex;gap:8px;align-items:center} .row>*{flex:1} .muted{color:var(--muted);font-size:12px}
    .btn{display:inline-block;padding:12px 14px;border-radius:10px;border:0;background:var(--brand);color:#fff;cursor:pointer;font-weight:600}
    .btn[disabled]{opacity:.5;cursor:not-allowed} .btn-ghost{background:#f3f4f6;color:#111827;border:1px solid var(--line)}
    .msg{margin-top:12px;font-size:14px} .ok{color:var(--ok);background:var(--okbg);padding:10px;border-radius:10px}
    .warn{color:var(--warn);background:var(--warnbg);padding:10px;border-radius:10px} .hr{height:1px;background:var(--line);margin:18px 0}
    .hide{display:none} .pill{font-size:12px;background:#eef2ff;color:#3730a3;border-radius:999px;padding:4px 8px;margin-left:6px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="step-consent">
      <h1>동의서 확인</h1>
      <p class="muted">아래 두 항목에 동의 후 조회 단계로 넘어갑니다. (필수)</p>
      <div class="grid">
        <div class="section">
          <h2>1) 개인정보 수집·이용 동의서 <span class="pill">필수</span></h2>
          <div class="scroll">
            <h3>수집 항목</h3><ul><li>참가자 이름, 전화번호 뒷 4자리</li></ul>
            <h3>수집·이용 목적</h3><ul><li>본인 확인 및 참가자별 안내 링크 조회/제공</li></ul>
            <h3>보유 및 이용 기간</h3><ul><li>수업 종료 후 최대 1년 또는 동의 철회 시 즉시 파기</li></ul>
            <h3>개인정보 제공에 대한 동의는 선택사항이나, 동의하지 않으실 경우 수업 참여가 제한될 수 있습니다.</h3>
          </div>
          <div class="row" style="align-items:center;margin-top:8px">
            <div style="flex:0 0 auto"><input type="checkbox" id="agree-privacy"></div>
            <label for="agree-privacy"><b>개인정보 수집·이용에 동의합니다.</b></label>
          </div>
        </div>

        <div class="section">
          <h2>2) 생성형 AI 활용 동의서 <span class="pill">필수</span></h2>
          <div class="scroll">
            <li>생성형 AI는 18세 이상부터 이용할 수 있으나, 일부 플랫폼의 경우 부모나 법정 보호자 동의하에 14세 미만 사용자도 사용할 수 있습니다.</li>
            <li><p>따라서 「개인정보보호법」제 15조, 제 17조, 제 18조, 제 22조 등에 따라 수집하는 개인정보, 목적을 확인한 뒤 '생성형 AI'활용 교육활동에 대한 동의를 받고자 합니다.</p></li>
            <li><p>활용동의 여부는 선택사항이나, 동의하지 않으실 경우 수업 참여가 제한될 수 있습니다. </p></li>
            <h3>대상</h3><ul><li>미래창의교육 특강 바이브코딩의 생성형 AI 활용 교육</li></ul>
            <h3>수집·이용·제공자</h3><ul><li>클로이드(Claude), 챗지피티(Chat-GPT), 뤼튼(Wrtn) 등 생성형 AI를 활용한 바이브코딩 실습</li></ul>
            <h3>수집 항목</h3><ul><li>생성 콘텐츠(음성·이미지·텍스트·영상) 파일, 서비스 이용 과정에서 자동으로 생성·수집되는 로그 및 사용 데이터, 기기 정보, 쿠키 등</li></ul>
            <h3>보유·이용 기간</h3><ul><li>수업 종료 후 최대 1년 또는 동의 철회 시 즉시 파기</li></ul>
            <h3>작성시 유의사항</h3><ul><li>만 14세 미만의 아동은 개인정보의 수집·이용 등에 법정대리인의 동의가 필요합니다.</li>
            <li><p>동의하지 않을 권리가 있으며, 미동의 시 미래창의교육 특강 바이브코딩 참여에 제한이 있을 수 있습니다.</p></li>
            <li><p>본 동의 내용은 미래창의교육 특강 이외의 다른 목적으로 사용되지 않으며, 동의철회 요청시 지체없이 파기됩니다.</p></li></ul>
          </div>
          <div class="row" style="align-items:center;margin-top:8px">
            <div style="flex:0 0 auto"><input type="checkbox" id="agree-ai"></div>
            <label for="agree-ai"><b>생성형 AI 활용에 동의합니다.</b></label>
          </div>
        </div>
      </div>

      <div class="hr"></div>
      <h3>서명 정보</h3>
      <div class="row">
        <div><label>학생(참가자) 이름</label><input id="sign-student" placeholder="예: 홍길동"></div>
        <div><label>전화번호 뒤 4자리</label><input id="sign-parent" placeholder="예: 0000"></div>
      </div>
      <p class="muted">*서명 정보는 조회 단계 입력란에도 자동 채워집니다.</p>

      <div class="row" style="margin-top:8px">
        <button class="btn" id="btn-accept" disabled>동의하고 조회 단계로 진행</button>
        <button class="btn btn-ghost" id="btn-print" type="button">인쇄/저장(PDF)</button>
      </div>
      <div id="consent-msg" class="msg"></div>
    </div>

    <div class="card hide" id="step-lookup">
      <h1>참가자 조회</h1>
      <p class="muted">동의가 완료되어 조회 기능이 활성화되었습니다.</p>

      <label for="pname">참가자 이름</label>
      <input id="pname" type="text" placeholder="예: 홍길동" autocomplete="off">
      <label for="gname">전화번호 뒤 4자리</label>
      <input id="gname" type="text" placeholder="예: 000" autocomplete="off">
      <button id="go" class="btn">조회</button>

      <div id="msg" class="msg"></div>

      <div id="result" class="section" style="display:none;">
        <div><b>조회 결과</b></div>
        <div class="row" style="margin-top:8px;">
          <input id="link" type="text" readonly>
          <button id="copy" class="btn btn-ghost" style="flex:0 0 auto;">복사</button>
        </div>
        <div class="row" style="margin-top:8px;">
          <a id="open" class="btn btn-ghost" href="#" target="_blank" style="text-decoration:none;text-align:center">새 탭에서 열기</a>
        </div>
        <p class="muted">자동 이동하지 않습니다. 필요 시 링크를 열거나 복사하세요.</p>
      </div>
    </div>

    <p class="muted" style="margin-top:12px">*본 템플릿은 예시이며, 실제 운영 시 내부 규정/법령에 맞춰 점검하세요.</p>
  </div>

<script>
// ====== 설정: Apps Script Web App ======
const GAS_URL = "https://script.google.com/macros/s/AKfycbzlbKFDtaNha3MMOTFz7Gi1RC7Id-A2ktOIMB_CEJywNGqBNInxLj1FKdWTUhxvYLNp7A/exec"; // 예: https://script.google.com/macros/s/AKfycbx.../exec
const ACCESS_TOKEN = "";                    // 토큰 사용 시 동일 값으로
const CONSENT_LOG_URL = GAS_URL;            // 같은 웹앱의 doPost 사용(분리하면 별도 URL)

function enableAcceptIfReady(){
  const a = document.getElementById('agree-privacy').checked;
  const b = document.getElementById('agree-ai').checked;
  const s = document.getElementById('sign-student').value.trim();
  const p = document.getElementById('sign-parent').value.trim();
  document.getElementById('btn-accept').disabled = !(a && b && s && p);
}
['agree-privacy','agree-ai','sign-student','sign-parent'].forEach(id => {
  document.getElementById(id).addEventListener('input', enableAcceptIfReady);
  document.getElementById(id).addEventListener('change', enableAcceptIfReady);
});

document.getElementById('btn-print').addEventListener('click', () => window.print());

document.getElementById('btn-accept').addEventListener('click', async () => {
  const msg = document.getElementById('consent-msg');
  msg.className = 'msg'; msg.textContent = '';
  const student = document.getElementById('sign-student').value.trim();
  const parent  = document.getElementById('sign-parent').value.trim();
  const payload = {
    student, parent, privacy:true, ai:true,
    ts: new Date().toISOString(),
    ua: navigator.userAgent,
    referer: location.href
  };
  try{
    // 동의 로그 저장(POST)
    const url = new URL(CONSENT_LOG_URL);
    if (ACCESS_TOKEN) url.searchParams.set("token", ACCESS_TOKEN);
    const res = await fetch(url.toString(), {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });
    const data = await res.json();
    if (!res.ok || !data.ok) throw new Error(data && data.error || '동의 기록 실패');

    // 다음 단계 전환 + 조회 입력값 프리필
    document.getElementById('pname').value = student;
    document.getElementById('gname').value = parent;
    document.getElementById('step-consent').classList.add('hide');
    document.getElementById('step-lookup').classList.remove('hide');
    window.scrollTo({top:0, behavior:'smooth'});
  }catch(e){
    msg.className = 'msg warn';
    msg.textContent = '동의 저장 중 오류: ' + e.message;
  }
});

async function lookup(pname, gname){
  const url = new URL(GAS_URL);
  url.searchParams.set("pname", pname.trim());
  url.searchParams.set("gname", gname.trim());
  if (ACCESS_TOKEN) url.searchParams.set("token", ACCESS_TOKEN);
  const res = await fetch(url.toString(), { method: "GET" });
  if(!res.ok) throw new Error("서버 응답 오류: " + res.status);
  return await res.json();
}

function showResult(link){
  const box = document.getElementById('result');
  const inp = document.getElementById('link');
  const open = document.getElementById('open');
  inp.value = link || "";
  open.href = link || "#";
  box.style.display = "block";
}

document.getElementById('go').addEventListener('click', async () => {
  const pname = document.getElementById('pname').value;
  const gname = document.getElementById('gname').value;
  const msg = document.getElementById('msg');
  const card = document.getElementById('result');
  card.style.display = "none";
  msg.className = "msg"; msg.textContent = "";

  if (!pname || !gname){
    msg.className = "msg warn"; msg.textContent = "두 항목을 모두 입력해 주세요."; return;
  }
  try {
    const r = await lookup(pname, gname);
    if (!r || r.ok !== true){
      msg.className = "msg warn"; msg.textContent = (r && r.error) ? r.error : "일치하는 항목이 없습니다."; return;
    }
    if (!r.link){
      msg.className = "msg warn"; msg.textContent = "일치하는 항목을 찾았지만 link가 비어 있습니다."; return;
    }
    msg.className = "msg ok"; msg.textContent = "조회 완료. 아래 링크를 확인하세요.";
    showResult(r.link);
  } catch (e){
    msg.className = "msg warn"; msg.textContent = e.message;
  }
});
</script>
</body>
</html>
